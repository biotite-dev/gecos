notifications:
  on_success: never
  on_failure: never

language: generic
matrix:
  include:
  - os: linux
    dist: trusty
    sudo: false
    env:
      - PY_VERSION='3.6'
      - COMPLETE=true
  - os: linux
    dist: trusty
    sudo: false
    env:
      - PY_VERSION='3.7'
      - COMPLETE=false

install:
  - MINICONDA=Miniconda3-latest-Linux-x86_64.sh
  - wget https://repo.continuum.io/miniconda/$MINICONDA
  
  - bash $MINICONDA -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda

  - conda create -q -n gecos-env python=$PY_VERSION
  - conda install -n gecos-env  -c conda-forge -c anaconda  biotite numpy matplotlib scikit-image pytest sphinx numpydoc
  - source activate gecos-env

script:
  - python setup.py test

before_deploy:
  - if [ $COMPLETE == true ]; then python setup.py bdist_wheel; fi
  - if [ $COMPLETE == true ]; then python setup.py build_sphinx; fi
  - if [ $COMPLETE == true ]; then cd doc/_build; fi
  - if [ $COMPLETE == true ]; then mv html doc; fi
  - if [ $COMPLETE == true ]; then zip -r doc.zip doc; fi
  - if [ $COMPLETE == true ]; then cd ../..; fi

deploy:
  provider: releases
  api-key:
    secure: "i8F/POCO+AW5WmT7eTidDHJH22+MC25vtm1k/CitXDGGAXuWMxydkuesz6ADif2FWoNKOw2PKYKgFH6K+RafApLefUj9aJrwYTto1krOs9iQrNK5h1uUdkwYHLS9Jb3RtUqEaySKpqLweUicMKYGeHGgHaoIKcl8oe3/pMsZKBse7XV60aXqHkNttlDv+/qo3uLlYOmohAoy9a8d7OsUJ3WeHveaCU2qpEz2DRFDIsl7PxPSjhG7nb0IrBvnL+REap614F2PT0GYR8EHa+kBZ8PL18AZS2u5apDAOHhAOOu3gvMYigzqCByQKLd2Q9Y+9bgKH7z9Jnd+VGPSCopdiYKKCdLHpAMB72BdqGBQ8sbv6V8mLDQmrdG0O8pw307VLYx1bukjfzHuykR7K70v0+FTcehYorHHSyiIrK1uPd76HHaVtcGBeNqhqi4LncWNB+wOpTzl9AKf/czpj6cbLM7c4YMH7jGcv0/VGh+tVbqBGQSDEsxVJoRxd8Efaelq7PPHwDD/MP2AI89AXqiZMkibS84yL567NUeCyaZQ6JloZPiRQM9uPeenEvtUWf9uwKVfI2g/OgkdW4PcrTg12o/I8aiiQQXYlUTTDjL5lI/3nR4yjTRt59D1ncEUSwpWS9ISAH2QMM3j5d7vCUfe0PY6BtU0Ma2/XlEqa/PIlS0="
  file:
    - dist/*
    - doc/_build/doc.zip
  file_glob: true
  on:
    repo: biotite-dev/gecos
    tags: true
  skip_cleanup: true
