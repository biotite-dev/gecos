notifications:
  on_success: never
  on_failure: never

language: generic
matrix:
  include:
  - os: linux
    dist: trusty
    sudo: false
    env:
      - PY_VERSION='3.6'
      - COMPLETE=true
  - os: linux
    dist: trusty
    sudo: false
    env:
      - PY_VERSION='3.7'
      - COMPLETE=false

install:
  - MINICONDA=Miniconda3-latest-Linux-x86_64.sh
  - wget https://repo.continuum.io/miniconda/$MINICONDA
  
  - bash $MINICONDA -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda

  - conda create -q -n gecos-env python=$PY_VERSION
  - conda install -n gecos-env  -c conda-forge -c anaconda  biotite numpy matplotlib scikit-image pytest sphinx numpydoc
  - source activate gecos-env

script:
  - python setup.py test

before_deploy:
  - if [ $COMPLETE == true ]; then python setup.py bdist_wheel; fi
  - if [ $COMPLETE == true ]; then python setup.py build_sphinx; fi
  - if [ $COMPLETE == true ]; then cd doc/_build; fi
  - if [ $COMPLETE == true ]; then mv html doc; fi
  - if [ $COMPLETE == true ]; then zip -r doc.zip doc; fi
  - if [ $COMPLETE == true ]; then cd ../..; fi

deploy:
  provider: releases
  api-key:
    secure: "OuB/48HCKfl98pv4wCmgnle8WYr2R+VWdQL6Gse3TBslqH4AdF8sOwGxis+WWJRcv/XgmoBEMmnL++N/b1D4/iWEyKYhRR6CrZdYzmL35IqghVRpSVCpHZTUFLZzLKwRBMK0K4dan0Ntur6qBZ6k47li4lY8FT19XzOJsD0Gz8TJA40+q8E+BosVYw6taXa1/xaDnSYEL+Hm0zpPOxCeYlqvIHVDKuL5YyuQs16I80w6wa7AsxDlyrEf6J3EncoPEIRgCKqRvpcy05nuiJOBXS4vUQMBzh8uQkpPOw+C1fWVkxOn5XNSsO+XKUJRxRYInQa9BDUoaLa8SKA3KRuWsgaNZiwyuq7UBWgEaut/+3J6QRJRC6dDz1uSM2EQP0MMvAwrELRykUZtY0WFr2WjWm91AKUZyLCwVNgEX29QKDyY8ranea3UQGBpdMxWw7L+Z9US1Prqzio916p0XuDMQ59BaWKr5upg70p27dCsLPzeSs+201/H6zfxjiv/eiWh4Hw7okudBRqt9BFlGM6aVb062Q3Rvs+OGaecPUSuysUunmVzESw5KDAFWyKMvmwi1ErB0DFx5XVYlkF4iu5VyWE0G4IJpBVjX5H0QP2wlKXHcw5B/HwXqiuZuxBRI1LOwKOOWdxjKdZZPrt8Jimle+Ro2kI48abpYUFbfTYcea8="
  file:
    - dist/*
    - doc/_build/doc.zip
  file_glob: true
  on:
    repo: biotite-dev/gecos
    tags: true
  skip_cleanup: true
